
# I. Overview
- Discoverer: topsec(CFF)
- Product Affected: TP-Link wr940n Router
- Firmware Version: 3.20.1 Build 200316 Rel.34392n (4555)

# II. Vulnerability Details
- When the router processes the request from WanStaticIpV6CfgRpm.htm, it does not check whether the value of the dnsserver variable is legal.<br>
  <div align=center><img src="./png/CFF_wr940n_detail.png" width = "800" height = "200" alt="Vulnerability details" align=center /></div>

# III. PoC
- **step 1: goto the ipv6 setup**<br>
  <div align=center><img src="./png/CFF_wr940n_goto_ipv6_setup.png" width = "600" height = "500" alt="goto_ipv6_setup" align=center /></div>

- **step 2: add breakpoint on dataEncrypt**<br>
  open web browser's devtools, add breakpoint on common.js before dataEncrypt.
  <div align=center><img src="./png/CFF_wr940n_add_breakpoint.png" width = "700" height = "400" alt="add_breakpoint" align=center /></div>

- **step 3: setting ipv6 data and click save**<br>
  <div align=center><img src="./png/CFF_wr940n_setting_ipv6.png" width = "700" height = "500" alt="setting ipv6" align=center /></div>
  after click save button, breakpoint will triggered

- **step 4: using console change form.dnsserver1.value to payload**<br>
  <div align=center><img src="./png/CFF_wr940n_add_payload.png" width = "400" height = "200" alt="post_payload" align=center /></div>
  after change this click run.

- **step 5: the router will reboot after post data**<br>
  uart output, reboot command executed!!
  <div align=center><img src="./png/CFF_wr940n_command_execute.png" width = "600" height = "400" alt="command_execute" align=center /></div>
  <div align=center><img src="./png/CFF_tplink_firmware_fixed.png" width = "600" height = "400" alt="tplink_fixed" align=center /></div>


# IV. Impact
- Authorized users can execute arbitrary commands

# V. Report timeline
