
# I. Overview
- Discoverer: topsec(CFF)
- Product Affected: TP-Link wr940n Router
- Firmware Version: 3.20.1 Build 200316 Rel.34392n (4555)

# II. Details
- When the router processes the request from WanStaticIpV6CfgRpm.htm, it does not check whether the value of the dnsserver variable is legal.<br>
![Vulnerability details](./png/CFF_wr940n_detail.png)

# III. PoC
- **step 1: goto the ipv6 setup**<br>
![ipv6 setup](./png/CFF_wr940n_goto_ipv6_setup.png)

- **step 2: add breakpoint on dataEncrypt**<br>
  open web browser's devtools, add breakpoint on common.js before dataEncrypt.
![add breakpoint](./png/CFF_wr940n_add_breakpoint.png)

- **step 3: setting ipv6 data and click save**<br>
![setting ipv6](./png/CFF_wr940n_setting_ipv6.png)<br>
  after click save button, breakpoint will triggered

- **step 4: using console change form.dnsserver1.value to payload**<br>
![add_payload](./png/CFF_wr940n_add_payload.png)<br>
  after change this click run.

- **step 5: the router will reboot after post data**<br>
  uart output, reboot command executed!!
![command_execute](./png/CFF_wr940n_command_execute.png)
![tplink_fixed](./png/CFF_tplink_fixed.png)


# IV. Impact
- Authorized users can execute arbitrary commands

# V. Report timeline
